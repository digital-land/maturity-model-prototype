{% extends "ripa_test/base.html" %}
{% block page_title %}RIPA tests | Operations dashboard | Digital Land{% endblock %}
{% block dl_breadcrumbs %}{% endblock %}
{% block main %}
  <main class="app-main-wrapper govuk-main-wrapper {{ mainClasses }}" id="main-content" role="main"{% if mainLang %}
        lang="{{ mainLang }}"{% endif %}>
    <div id="#top">
      <h1 class="govuk-heading-m">Data test results - {{ date_of_test_run }}</h1>
    </div>
    {% block content %}
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
          <div class="app-c-test-grid">
            {% for la in local_authorities.keys() %}
              <div class="app-c-test-grid__row">
                <div class="app-c-test-grid__label">
                  {{ local_authorities[la] }}
                </div>
                <div class="app-c-test-grid__items">
                  {% for dataset, result in results_grid[la].items() %}
                    <div class="app-c-test-grid__item">
                      <span class="app-c-test-grid__result app-c-test-grid__result--{{ result | pass_fail }}">
                        <span>{% if result in [True, False] %}<a href="#{{ la }}-{{ dataset }}" style="color: inherit">{% endif %}{{ dataset | unhyphenate | capitalize }}{% if result  in [True, False] %}</a>{% endif %}</span>
                    <span class="app-c-test-grid__result-label">{{ result | pass_fail | capitalize }}</span>
                  </span>
                    </div>
                  {% endfor %}
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
      <div class="govuk-grid-row" style="margin-top: 2.5em">
        <div class="govuk-grid-column-full">
          <h2 class="govuk-heading-m">Detailed results</h2>
        </div>
      </div>
      {% for key, results in grouped_result.items() %}
        <div class="govuk-grid-row">
          <div class="govuk-grid-column-full">
              <table class="govuk-table" id="{{ key[0] }}-{{ key[1] }}">
                <caption class="govuk-table__caption govuk-table__caption--m">{{  local_authorities[key[0]]  }} - {{ key[1] }}</caption>
                <thead class="govuk-table__head">
                  <tr class="govuk-table__row govuk-body-s">
                    <th scope="col" class="govuk-table__header">Test name</th>
                    <th scope="col" class="govuk-table__header">Query</th>
                    <th scope="col" class="govuk-table__header">Path</th>
                    <th scope="col" class="govuk-table__header">Expected</th>
                    <th scope="col" class="govuk-table__header">Actual</th>
                    <th scope="col" class="govuk-table__header">Passed</th>
                  </tr>
                </thead>
                <tbody class="govuk-table__body">
                  {% for result in results %}
                    <tr class="govuk-table__row govuk-body-s">
                      <td class="govuk-table__cell">{{result.test_name}}</td>
                      <td class="govuk-table__cell"><a href="https://www.digital-land.info/entity.json{{result.query}}">{{result.query}}</a></td>
                      <td class="govuk-table__cell">{{result.path}}</td>
                      <td class="govuk-table__cell">{{result.expected}}</td>
                      <td class="govuk-table__cell">{{result.actual}}</td>
                      <td class="govuk-table__cell">{{result.match}}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
          </div>
        </div>
      {% endfor %}
    {% endblock content %}
  </main>
{% endblock main %}

{% block footer %}
  <div class="dl-sticky-banner__container" data-module="sticky-banner">
    <div class="dl-sticky-banner">
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-one-half">
          {# need a macro for this bit, param would set the href #}
          <a href="#btt-hook" class="govuk-link govuk-link--no-visited-state back-to-top__link">
            <svg role="presentation" focusable="false" class="dl-back-to-top__icon" xmlns="http://www.w3.org/2000/svg"
                 width="13" height="17" viewBox="0 0 13 17">
              <path fill="currentColor" d="M6.5 0L0 6.5 1.4 8l4-4v12.7h2V4l4.3 4L13 6.4z"></path>
            </svg>
            Back to top
          </a>
        </div>
      </div>
    </div>
  </div>
  {{ super() }}
{% endblock %}

{% block pageScripts %}
  {{ super() }}
{% endblock pageScripts %}
