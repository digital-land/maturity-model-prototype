{% extends "layouts/layout.html" %}
{% block page_title %}Team performance | Maturity Model | Digital Land{% endblock %}
{%- from "digital-land-frontend/components/feedback-panel/macro.html" import dlFeedbackPanel %}

{% block content %}
<main id="content" role="main">
  <h1 class="govuk-heading-xl">Digital land team performance</h1>

  <div class="govuk-grid-row govuk-!-margin-bottom-2 govuk-!-margin-top-9">
    <div class="govuk-grid-column-one-half">
      <div class="data-item govuk-!-margin-bottom-6">
        <span class="data-item__number govuk-!-font-size-80">{{ entity_count|commanum }}</span>
        <p class="govuk-body govuk-!-font-size-36">Entities</p>
      </div>
      <details class="govuk-details" data-module="govuk-details">
        <summary class="govuk-details__summary">
          <span class="govuk-details__summary-text dl-small-text">
            What is an entity?
          </span>
        </summary>
        <div class="govuk-details__text dl-small-text"></div>
      </details>
    </div>
  </div>

  <div class="govuk-grid-row govuk-!-margin-bottom-9">
    <div class="govuk-grid-column-one-quarter">
      <div class="data-item govuk-!-margin-bottom-6">
        <span class="data-item__number govuk-!-font-size-80">{{ high_level_numbers['datasets_with_data'] }}<span class="govuk-!-font-size-19">/{{ datasets|length }}</span></span>
        <p class="govuk-body govuk-!-font-size-36">Datasets</p>
      </div>
    </div>
    <div class="govuk-grid-column-one-quarter">
      <div class="data-item govuk-!-margin-bottom-6">
        <span class="data-item__number govuk-!-font-size-80">{{ sources['with_endpoint'] }}</span>
        <p class="govuk-body govuk-!-font-size-36">Sources</p>
      </div>
    </div>
    <div class="govuk-grid-column-one-quarter">
      <div class="data-item govuk-!-margin-bottom-6">
        <span class="data-item__number govuk-!-font-size-80">{{ high_level_numbers['resources'] }}</span>
        <p class="govuk-body govuk-!-font-size-36">Resources</p>
      </div>
    </div>
    <div class="govuk-grid-column-one-quarter">
      <div class="data-item govuk-!-margin-bottom-6">
        <span class="data-item__number govuk-!-font-size-80">{{ org_count }}</span>
        <p class="govuk-body govuk-!-font-size-36">Organisations</p>
      </div>
    </div>
  </div>

  <div class="govuk-tabs" data-module="dlf-subnav">
    <h2 class="govuk-tabs__title">
      Contents
    </h2>
    <nav class="dlf-subnav" aria-label="Sub navigation">
        <ul class="dlf-subnav__list">
            <li class="dlf-subnav__list-item dlf-subnav__list-item--selected">
                <a class="dlf-subnav__list-item__link" href="#dataset" data-module-sub-nav="tab">
                Datasets
                </a>
            </li>
            <li class="dlf-subnav__list-item">
                <a class="dlf-subnav__list-item__link" href="#sources" data-module-sub-nav="tab">
                Sources and resources
                </a>
            </li>
        </ul>
    </nav>

    <div id="dataset">
      {% include 'dashboard/partials/dataset-table.html' %}
    </div>
  
    <div id="sources">
      <h2 class="govuk-heading-l govuk-!-margin-top-9">Sources and resources</h2>

      <h3 class="govuk-heading-m">Overview of sources</h3>

      <div class="govuk-grid-row govuk-!-margin-bottom-9">
        <div class="govuk-grid-column-one-half">
          <div class="data-item govuk-!-margin-bottom-6">
            <span class="data-item__number govuk-!-font-size-48">{{ sources['with_endpoint'] }}</span>
            <p class="govuk-body govuk-!-font-size-19">Total</p>
          </div>
          <details class="govuk-details" data-module="govuk-details">
            <summary class="govuk-details__summary">
              <span class="govuk-details__summary-text dl-small-text">
                What does this tell us?
              </span>
            </summary>
            <div class="govuk-details__text dl-small-text">
              This is the number of places Digital land attempts to collect data from each night. The number shows the challenge anyone looking for planning data faces.
            </div>
          </details>
        </div>
        <div class="govuk-grid-column-one-half">
          <div class="data-item govuk-!-margin-bottom-6">
            <span class="data-item__number govuk-!-font-size-48">{{ sources['no_documentation']['count'] }}</span>
            <p class="govuk-body govuk-!-font-size-19">Without a documentation URL</p>
          </div>
          <details class="govuk-details" data-module="govuk-details">
            <summary class="govuk-details__summary">
              <span class="govuk-details__summary-text dl-small-text">
                What does this tell us?
              </span>
            </summary>
            <div class="govuk-details__text dl-small-text">
              When we add a source we usually record a <code>documentation-url</code>. This is the place where we found the source. It helps us answer questions about where we found the source and why we are collecting it. Without it we are less confident about the origin of the source and therefore the authority of the data.
            </div>
          </details>
          <details class="govuk-details" data-module="govuk-details">
            <summary class="govuk-details__summary">
              <span class="govuk-details__summary-text dl-small-text">
                See breakdown by dataset
              </span>
            </summary>
            <div class="govuk-details__text dl-small-text">
              <ul class="govuk-list">
                {% for col in sources['no_documentation']['collection'] %}
                  <li><a href="{{ url_for('base.dataset_performance', dataset_name=col['label']) }}">{{ col['label'] }}</a>: {{ col['count'] }}</li>
                {% endfor %}
              </ul>
            </div>
          </details>
        </div>
      </div>

      <h3 class="govuk-heading-m">Sources and resources by month</h3>
      <figure class="highcharts-figure govuk-!-margin-bottom-9">
        <div id="container"></div>
        <p class="highcharts-description govuk-body govuk-!-margin-top-4">
          A chart showing the number of sources Digital land have added each month and the number of new resources collected each month.
          enhanced readability.
        </p>
      </figure>
    </div>

  </div>

</main>
{% endblock %}

{% block bodyEnd %}
{{ super() }}

<script>
  const $subNavTabs = document.querySelector('[data-module="dlf-subnav"]')
  const subNavTabsComponent = new DLFrontend.SubNavTabs($subNavTabs).init({})
</script>

{% include 'partials/high-charts-scripts.html' %}
<script src="/static/javascripts/vendor/jquery-3.4.1.min.js"></script>
<script src="/static/javascripts/vendor/MOJFrontend.SortableTable.js"></script>
<script>
(function($) {
    $(function() {
      var tables = $('table')
      console.log(tables[0])
      var sTable = new MOJFrontend.SortableTable({
          table: $('table')[0],
          statusVisible: true,
          tableWrapperSelector: ".data-table__wrapper"
      });
    });
}(jQuery));
</script>
<script>
  Highcharts.chart('container', {

title: {
  text: ''
},

yAxis: {
  title: {
    text: 'Number of items'
  }
},

xAxis: {
  categories: {{ stats['months']|tojson }},
  labels: {
    step: 7
  },
  accessibility: {
    rangeDescription: 'Range: December 2016 to now'
  }
},

legend: {
  layout: 'vertical',
  align: 'right',
  verticalAlign: 'middle'
},

plotOptions: {
  series: {
    label: {
      connectorAllowed: false
    },
    marker: {
      symbol: 'circle',
      lineWidth: 1
    }
  }
},

series: [{
  name: 'Sources',
  data: {{ stats['sources']|tojson }},
  color: '#5694ca'
}, {
  name: 'Resources',
  data:{{ stats['resources']|tojson }},
  color: '#003078'
}],

responsive: {
  rules: [{
    condition: {
      maxWidth: 500
    },
    chartOptions: {
      legend: {
        layout: 'horizontal',
        align: 'center',
        verticalAlign: 'bottom'
      }
    }
  }]
}

});
</script>
{% endblock bodyEnd %}
