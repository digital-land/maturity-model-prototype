{% extends "layouts/layout.html" %}
{% block page_title %}Brownfield land | Dataset performance | Maturity Model | Digital Land{% endblock %}
{%- from "digital-land-frontend/components/feedback-panel/macro.html" import dlFeedbackPanel %}

{% block content %}
<main id="content" role="main">
  <span class="govuk-caption-xl">Dataset performance</span>
  <h1 class="govuk-heading-xl">{{ name }}</h1>

  
  <h3 class="govuk-heading-m">Dataset info</h3>

  <dl class="govuk-summary-list">

    {% if dataset['name'] %}
    <div class="govuk-summary-list__row">
      <dt class="govuk-summary-list__key">
        Name
      </dt>
      <dd class="govuk-summary-list__value">
        {{ dataset['name'] }}
      </dd>
    </div>
    {% endif %}

    {% if dataset['project'] %}
    <div class="govuk-summary-list__row">
      <dt class="govuk-summary-list__key">
        Project
      </dt>
      <dd class="govuk-summary-list__value">
        <a href="https://digital-land.github.io/project'{{ dataset['project'] }}">{{ dataset['project'] }}</a>
      </dd>
    </div>
    {% endif %}

    {% if dataset['pipeline'] %}
    <div class="govuk-summary-list__row">
      <dt class="govuk-summary-list__key">
        Pipeline
      </dt>
      <dd class="govuk-summary-list__value">
        <a href="https://github.com/digital-land/{{ dataset['pipeline'] }}">{{ dataset['pipeline'] }}</a>
      </dd>
    </div>
    {% endif %}

    {% if dataset['data-provider'] %}
    <div class="govuk-summary-list__row">
      <dt class="govuk-summary-list__key">
        Data provider
      </dt>
      <dd class="govuk-summary-list__value">
        {{ dataset['data-provider'] }}
      </dd>
    </div>
    {% endif %}

    {% if dataset['category'] %}
    <div class="govuk-summary-list__row">
      <dt class="govuk-summary-list__key">
        Category
      </dt>
      <dd class="govuk-summary-list__value">
        {{ dataset['category'] }}
      </dd>
    </div>
    {% endif %}
    
  </dl>

  <h2 class="govuk-heading-l govuk-!-margin-top-9">By organisation</h2>

  <div class="govuk-tabs" data-module="govuk-tabs">
    <h2 class="govuk-tabs__title">
      Contents
    </h2>
    <ul class="govuk-tabs__list">
      <li class="govuk-tabs__list-item govuk-tabs__list-item--selected">
        <a class="govuk-tabs__tab" href="#expected-orgs">
          Active
        </a>
      </li>
      <li class="govuk-tabs__list-item">
        <a class="govuk-tabs__tab" href="#no-resource">
          No active resource
        </a>
      </li>
    </ul>

  <div class="govuk-tabs__panel" id="expected-orgs">
    <table class="govuk-table">
      <caption class="govuk-table__caption govuk-table__caption--m">Expected organisations</caption>
      <thead class="govuk-table__head">
        <tr class="govuk-table__row">
          <th scope="col" class="govuk-table__header govuk-\!-width-one-quarter" aria-sort="none">Name</th>
          <th scope="col" class="govuk-table__header dl-cell-date" aria-sort="none">Total records</th>
          <th scope="col" class="govuk-table__header govuk-table__header--numeric" aria-sort="none">Active sources</th>
          <th scope="col" class="govuk-table__header govuk-table__header--numeric" aria-sort="none">Inactive sources</th>
          <th scope="col" class="govuk-table__header govuk-table__header--numeric" aria-sort="none">Total resources</th>
          <th scope="col" class="govuk-table__header govuk-table__header--numeric" aria-sort="none">Active resources</th>
          <th scope="col" class="govuk-table__header govuk-table__header--numeric" aria-sort="none">Days since update</th>
        </tr>
      </thead>
      <tbody class="govuk-table__body">
        {% for org in orgs.withresource %}
        {% set total_resources = org['active-resource']|to_int + org['inactive-resource']|to_int %}
        {% set orgIdPieces = org['organisation'].split(':')  %}
        <tr class="govuk-table__row">
          <td class="govuk-table__cell" data-sort-value="{{ org['name'] }}"><a href="{{ url_for('base.organisation_performance', prefix=orgIdPieces[0], org_id=orgIdPieces[1]) }}" class="govuk-link">{{ org['name'] }}</a></td>
          <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="{{ org['total-records']|to_int }}">{{ org['total-records'] }}</td>
          <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="{{ org['active-sources']|to_int }}">{{ org['active-sources'] }}</td>
          <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="{{ org['inactive-sources']|to_int }}">{{ org['inactive-sources'] }}</td>
          <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="{{ total_resources }}">{{ total_resources }}</td>
          <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="{{ org['active-resource']|to_int }}">{{ org['active-resource'] }}</td>
          <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="{{ org['days-since-new-resource-added']|to_int }}">{{ org['days-since-new-resource-added'] }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="govuk-tabs__panel" id="no-resource">
    <table class="govuk-table">
      <caption class="govuk-table__caption govuk-table__caption--m">No active resource</caption>
      <thead class="govuk-table__head">
        <tr class="govuk-table__row">
          <th scope="col" class="govuk-table__header govuk-\!-width-one-quarter" aria-sort="none">Name</th>
          <th scope="col" class="govuk-table__header dl-cell-date" aria-sort="none">Total records</th>
          <th scope="col" class="govuk-table__header govuk-table__header--numeric" aria-sort="none">Active sources</th>
          <th scope="col" class="govuk-table__header govuk-table__header--numeric" aria-sort="none">Inactive sources</th>
          <th scope="col" class="govuk-table__header govuk-table__header--numeric" aria-sort="none">Total resources</th>
          <th scope="col" class="govuk-table__header govuk-table__header--numeric" aria-sort="none">Active resources</th>
          <th scope="col" class="govuk-table__header govuk-table__header--numeric" aria-sort="none">Days since update</th>
        </tr>
      </thead>
      <tbody class="govuk-table__body">
        {% for org in orgs.noresource %}
        {% set total_resources = org['active-resource']|to_int + org['inactive-resource']|to_int %}
        {% set orgIdPieces = org['organisation'].split(':')  %}
        <tr class="govuk-table__row">
          <td class="govuk-table__cell" data-sort-value="{{ org['name'] }}"><a href="{{ url_for('base.organisation_performance', prefix=orgIdPieces[0], org_id=orgIdPieces[1]) }}" class="govuk-link">{{ org['name'] }}</a></td>
          <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="{{ org['total-records']|to_int }}">{{ org['total-records'] }}</td>
          <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="{{ org['active-sources']|to_int }}">{{ org['active-sources'] }}</td>
          <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="{{ org['inactive-sources']|to_int }}">{{ org['inactive-sources'] }}</td>
          <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="{{ total_resources }}">{{ total_resources }}</td>
          <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="{{ org['active-resource']|to_int }}">{{ org['active-resource'] }}</td>
          <td class="govuk-table__cell govuk-table__cell--numeric" data-sort-value="{{ org['days-since-new-resource-added']|to_int }}">{{ org['days-since-new-resource-added'] }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
</main>
{% endblock %}

{% block bodyEnd %}
{{ super() }}
<script>
  console.log({{ dataset|tojson }})
</script>
{% endblock bodyEnd %}

